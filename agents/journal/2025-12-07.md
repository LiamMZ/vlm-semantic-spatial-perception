### 2025-12-07-1734 – Structured analysis schema + parser alignment

- **Owner**: AI Agent (prompt hardening)
- **Agents affected**: ObjectTracker prompts, perception docs
- **Git commit(s)**: Based on b328f4b38c59a9cb92fd92a25d0a9261a1a45c01
- **Context**: Object analysis prompts needed an explicit structured format; follow-ups refined the shape (drop confidence/properties/bounding boxes, switch interaction points to list form) and aligned parsing.
- **Actions**:
  - Added and iterated a JSON schema for analysis prompts, trimming to `object_type`, `position`, optional `affordances`, `predicates`, and a list of `{affordance, position, reasoning}` interaction points.
  - Wired ObjectTracker analysis calls to enforce the schema via `response_json_schema` and simplified parsing to the list-only interaction point shape.
  - Updated perception/prompt docs to reflect the structured contract.
- **Result**: Analysis responses now follow a clear, minimal schema and the tracker consumes the list-based interaction point format without legacy parsing paths.
- **References**: `config/object_tracker_prompts.yaml`, `src/perception/object_tracker.py`, `agents/design/prompts_configuration.md`, `docs/perception.md`

### 2025-12-07-1636 – Relax primitive translation requirements

- **Owner**: AI Agent (bug fix)
- **Agents affected**: PrimitiveExecutor, primitive docs, pick translation tests, async example tests
- **Git commit(s)**: Based on 250a66655375b7095bc801a5d42cff31392b6ba8
- **Context**: Pytest failures surfaced from forcing helper pixel translation onto gripper primitives and requiring a camera pose helper on any primitives interface; async example tests also lacked markers.
- **Actions**: Allowed translation only when helper pixels exist, tolerated missing `camera_pose_from_joints` on primitive drivers, converted back-projected positions to lists, and marked async example tests with `pytest.mark.asyncio`; updated planning/primitives docs accordingly.
- **Result**: Translation no longer errors on gripper calls or missing camera pose helpers; targeted tests now pass (`tests/test_primitive_executor.py::test_execute_plan_serializes_joint_state_results`, `tests/test_pick_translation_to_xarm.py::test_pick_plan_translates_to_xarm_calls`).
- **References**: `src/primitives/primitive_executor.py`, `examples/test_orchestrator_solver.py`, `examples/test_predicate_validation.py`, `examples/test_tamp_integration.py`, `docs/planning.md`, `agents/design/primitive_task_breakdown_plan.md`

### 2025-12-07-1708 – Async plugin + translation precision

- **Owner**: AI Agent (bug fix)
- **Agents affected**: PrimitiveExecutor, test dependencies
- **Git commit(s)**: Based on 250a66655375b7095bc801a5d42cff31392b6ba8
- **Context**: Remaining pytest failures stemmed from missing async support (marks unrecognized) and a float precision delta when applying depth offsets during helper translation.
- **Actions**: Added `pytest-asyncio` to test dependencies and coerced back-projected points to float64 before applying depth offsets to keep helper translation stable.
- **Result**: Async markers are now supported once deps are installed; target positions match expected values in `test_prepare_plan_translates_pixel_targets`. Full test suite not re-run after dependency edit.
- **References**: `pyproject.toml`, `src/primitives/primitive_executor.py`, `tests/test_primitive_executor.py`

### 2025-12-07-1623 – Inline helper translation

- **Owner**: AI Agent (refactor)
- **Agents affected**: PrimitiveExecutor
- **Git commit(s)**: Based on 250a66655375b7095bc801a5d42cff31392b6ba8
- **Context**: Requested to collapse `_translate_helper_parameters` into `prepare_plan` for clarity while retaining hard failures on missing depth/intrinsics or back-projection.
- **Actions**: Inlined target pixel back-projection/offset handling inside the per-primitive loop and removed the helper method.
- **Result**: Translation logic now lives entirely in `prepare_plan` with the same failure semantics. Tests not rerun (torch/google.genai deps absent).
- **References**: `src/primitives/primitive_executor.py`

### 2025-12-07-1620 – Enforce back-projection failures

- **Owner**: AI Agent (refactor)
- **Agents affected**: PrimitiveExecutor
- **Git commit(s)**: Based on 250a66655375b7095bc801a5d42cff31392b6ba8
- **Context**: Back-projection misses were silently logged as warnings; requirement is to hard-fail with full stack context.
- **Actions**: Raised runtime errors when depth/intrinsics are missing or back-projection returns None for `target_pixel_yx` translation.
- **Result**: Executor now propagates errors (with stack traces) on translation failures instead of continuing. Tests not rerun (torch/google.genai deps absent).
- **References**: `src/primitives/primitive_executor.py`

### 2025-12-07-1612 – Simplify back-projection path

- **Owner**: AI Agent (refactor)
- **Agents affected**: PrimitiveExecutor, primitive docs/config
- **Git commit(s)**: Based on 250a66655375b7095bc801a5d42cff31392b6ba8
- **Context**: Requested to inline pixel back-projection, drop unused pivot helper translation, and always translate from `target_pixel_yx` (no `position_2d` fallback) to align executor behavior with orchestrator logging.
- **Actions**:
  - Inlined back-projection inside `_translate_helper_parameters`, removed `pivot_pixel_yx` handling, and simplified translation to consume only `target_pixel_yx` (with 3D override when provided).
  - Updated planning/primitives docs and primitive catalog text to drop pivot helper references.
- **Result**: Translation now logs back-projection misses directly and only translates `target_pixel_yx`; pivot helper docs cleaned up. Tests not re-run (torch/google.genai deps missing).
- **References**: `src/primitives/primitive_executor.py`, `docs/planning.md`, `agents/design/primitive_task_breakdown_plan.md`, `config/primitive_descriptions.md`

### 2025-12-07-1605 – PrimitiveExecutor logging & failure handling

- **Owner**: AI Agent (logging refactor)
- **Agents affected**: PrimitiveExecutor, TaskAndMotionPlanner, run_cached_plan, primitives docs/tests
- **Git commit(s)**: Based on 250a66655375b7095bc801a5d42cff31392b6ba8
- **Context**: PrimitiveExecutor was returning warning/error lists instead of relying on structured logging and exceptions; updated behavior to propagate orchestrator logging and fail fast.
- **Actions**:
  - Routed PrimitiveExecutor translation/execution messaging through structured logging, raised on validation/primitive binding failures, and injected the orchestrator logger into the executor.
  - Updated call sites, scripts, and tests to drop warnings/errors payloads (capturing warnings via logging where needed) and aligned TAMP executor handling.
  - Refreshed primitive execution docs to describe logging-driven warnings and exception paths.
- **Result**: Executor now logs warnings and raises errors instead of collecting message lists; task planner/demo code align with the new contract. Targeted pytest runs were blocked locally by missing `torch` and `google.genai` dependencies.
- **References**: `src/primitives/primitive_executor.py`, `src/task_motion_planner.py`, `scripts/run_cached_plan.py`, `tests/test_primitive_executor.py`, `tests/test_pick_translation_to_xarm.py`, `docs/planning.md`, `agents/design/primitive_task_breakdown_plan.md`
