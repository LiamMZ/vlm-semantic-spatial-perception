### 2025-11-24-1717 – Normalize helper coords and drop backward compatibility

- **Owner**: AI Agent (coord refactor)
- **Agents affected**: SkillDecomposer, PrimitiveExecutor, prompts, planning docs, pick translation tests
- **Git commit(s)**: Based on 7538ba5d3f2fffd4cbf9dfe42ce4721dfd48e6bc
- **Context**: The helper fields drifted back to absolute pixels; we need to enforce normalized [y, x] (0–1000) across prompt, executor, and tests without legacy paths.
- **Actions**:
  - Reverted executor helper handling to accept only normalized coords, removed pixel/compat conversions, and seeded target helpers directly from snapshot interaction points.
  - Tightened prompt/docs to specify normalized coordinates; stripped pixel formatting from decomposer context.
  - Updated pick translation test stubs and helper naming to align with normalized inputs; clarified error handling by requiring LLM responses to include text.
- **Result**: Helper parameters and interaction points are consistently treated as normalized coordinates; executor/back-projection no longer supports pixel fallbacks; tests/docs aligned.
- **References**: `src/primitives/primitive_executor.py`, `src/primitives/skill_decomposer.py`, `config/skill_decomposer_prompts.yaml`, `tests/test_pick_translation_to_xarm.py`, `docs/planning.md`, `docs/perception.md`

### 2025-11-24-1547 – Stream RealSense logs via Python logging

- **Owner**: AI Agent (logging)
- **Agents affected**: TaskOrchestrator, RealSense camera, Orchestrator TUI
- **Git commit(s)**: Based on 0bf79349c6fef5810e8a3c36d8fe1fba4c2b8a63
- **Context**: RealSense debug output buffered until init finished because stdout was redirected; need real-time logs in the Textual UI without touching the minimal logger.
- **Actions**: Added `configure_logging`/callback handler in `src/utils/logging_utils.py`, refactored `TaskOrchestrator` and `RealSenseCamera` to use Python logging, and wired the TUI demo to stream logs via the callback instead of stdout capture.
- **Result**: RealSense and orchestrator logs emit live into the demo UI and session log; minimal logger kept unchanged. No tests executed.
- **References**: `src/utils/logging_utils.py`, `src/planning/task_orchestrator.py`, `src/camera/realsense_camera.py`, `examples/orchestrator_demo.py`, `docs/ORCHESTRATOR.md`, `agents/design/architecture.md`, `agents/design/orchestrator_observation_snapshot_plan.md`

### 2025-11-24-1549 – Prompt includes normalized interaction coordinates

- **Owner**: AI Agent (prompt tweak)
- **Agents affected**: SkillDecomposer, prompts, planning docs
- **Git commit(s)**: Based on 0bf79349c6fef5810e8a3c36d8fe1fba4c2b8a63
- **Context**: LLM was inventing grasp points because the prompt didn’t surface existing interaction coordinates and always invited new proposals.
- **Actions**: Added normalized interaction point coordinates to the object listings, instructed the LLM to reuse existing points (omit `interaction_points`) and only add new affordance+point pairs when needed, reused `pixel_to_normalized` helper instead of ad-hoc normalization, and refreshed paired docs.
- **Result**: Prompt now exposes snapshot-grounded coordinates; LLM guidance avoids redundant interaction point echoes. Tests not run (LLM-gated).
- **References**: `config/skill_decomposer_prompts.yaml`, `src/primitives/skill_decomposer.py`, `agents/design/primitive_task_breakdown_plan.md`, `docs/planning.md`

### 2025-11-24-1540 – Retarget pick tests to Black fabric garment

- **Owner**: AI Agent (test sync)
- **Agents affected**: LLM pick translation/decomposition tests
- **Git commit(s)**: Based on 0bf79349c6fef5810e8a3c36d8fe1fba4c2b8a63
- **Context**: The continuous_pick fixture renamed the cloth object to `black_fabric_garment`, but tests still targeted the old towel id.
- **Actions**: Pointed test helpers, parameters, assertions, and error messages at `black_fabric_garment` to match the refreshed fixture.
- **Result**: Pick tests now reference the current cloth asset; tests not executed (one requires API, the other unchanged logic).
- **References**: `tests/test_pick_translation_to_xarm.py`, `tests/test_pick_decomposition_llm.py`

### 2025-11-24-1449 – Clarify PrimitiveExecutor primitives interface name

- **Owner**: AI Agent (naming cleanup)
- **Agents affected**: PrimitiveExecutor, docs, cached plan runner, primitive tests
- **Git commit(s)**: Based on 615f73b7d6835d214dcbe7f3d4f1a21e492354c2
- **Context**: The executor field name `planner` read as the high-level PDDL planner; rename to reflect the primitives driver.
- **Actions**:
  - Renamed the executor attribute/constructor arg to `primitives` and adjusted missing-method warnings.
  - Updated docs, tests, and the cached-plan runner helper to pass the new `primitives` argument.
- **Result**: PrimitiveExecutor now refers to its primitive driver explicitly; no tests executed (pytest blocked: missing torch dependency).
- **References**: `src/primitives/primitive_executor.py`, `scripts/run_cached_plan.py`, `tests/test_primitive_executor.py`, `tests/test_pick_decomposition_llm.py`, `tests/test_pick_translation_to_xarm.py`, `docs/planning.md`, `agents/design/primitive_task_breakdown_plan.md`, `agents/design/architecture.md`

### 2025-11-24-1513 – Move interaction points into snapshot detections

- **Owner**: AI Agent (data/layout refactor)
- **Agents affected**: SkillDecomposer, fixtures, docs
- **Git commit(s)**: Based on 615f73b7d6835d214dcbe7f3d4f1a21e492354c2
- **Context**: Interaction points should be tied to specific detections/snapshots rather than stored in the registry with latest positions.
- **Actions**: Migrated fixture interaction points from the registry to each snapshot’s detections, stripped latest position fields from the registry, taught SkillDecomposer to load/merge detection interaction points, and updated tests/docs accordingly.
- **Result**: Interaction points now live with snapshot detections; the decomposer pulls them from the latest snapshot and only keeps `latest_observation` in the registry.
- **References**: `src/primitives/skill_decomposer.py`, `tests/assets/continuous_pick_fixture/registry.json`, `tests/assets/continuous_pick_fixture/perception_pool/snapshots/*/detections.json`, `tests/test_pick_translation_to_xarm.py`, `agents/design/primitive_task_breakdown_plan.md`, `docs/planning.md`

### 2025-11-24-1504 – Update LLM pick test artifacts

- **Owner**: AI Agent (test cleanup)
- **Agents affected**: LLM pick decomposition test
- **Git commit(s)**: Based on 615f73b7d6835d214dcbe7f3d4f1a21e492354c2
- **Context**: Interaction-point enrichment call removed; test should only capture the main plan response.
- **Actions**: Simplified test recording to write a single LLM response artifact and removed the unused `interaction_points.json` path.
- **Result**: Test artifacts now match the single-call flow.
- **References**: `tests/test_pick_decomposition_llm.py`

### 2025-11-24-1501 – Remove interaction point enrichment path

- **Owner**: AI Agent (simplification)
- **Agents affected**: SkillDecomposer, docs
- **Git commit(s)**: Based on 615f73b7d6835d214dcbe7f3d4f1a21e492354c2
- **Context**: Assume interaction points already exist; drop enrichment requests.
- **Actions**: Removed missing-request tracking and enrichment calls from `SkillDecomposer`, kept only warnings for absent points, and updated design/product docs accordingly.
- **Result**: Plans rely on registry interaction points; no follow-up LLM enrichment is attempted.
- **References**: `src/primitives/skill_decomposer.py`, `agents/design/primitive_task_breakdown_plan.md`, `docs/planning.md`

### 2025-11-24-1448 – Drop interaction point backward compatibility

- **Owner**: AI Agent (refactor)
- **Agents affected**: SkillDecomposer, SkillPlanDiagnostics, LLM tests/docs
- **Git commit(s)**: Based on 615f73b7d6835d214dcbe7f3d4f1a21e492354c2
- **Context**: Align interaction point handling solely on `interaction_points` with no legacy fallbacks.
- **Actions**: Removed `new_interaction_points` parsing/serialization paths, tightened interaction-point extraction to `interaction_points` only, updated diagnostics schema and tests, and refreshed docs.
- **Result**: LLM outputs must use `interaction_points`; parsing/serialization no longer support legacy fields.
- **References**: `src/primitives/skill_decomposer.py`, `src/primitives/skill_plan_types.py`, `tests/test_pick_decomposition_llm.py`, `tests/test_pick_translation_to_xarm.py`, `agents/design/primitive_task_breakdown_plan.md`, `docs/planning.md`

### 2025-11-24-1447 – Interaction points preferred over new_interaction_points

- **Owner**: AI Agent (refactor + docs)
- **Agents affected**: SkillDecomposer prompt/schema alignment
- **Git commit(s)**: Based on 615f73b7d6835d214dcbe7f3d4f1a21e492354c2
- **Context**: Clarify that proposed affordance points should use `interaction_points` instead of `new_interaction_points`.
- **Actions**: Updated plan prompt/schema to prefer `interaction_points`, adjusted parsing to map that field into diagnostics, and refreshed design/product docs.
- **Result**: LLMs are guided to emit proposed points under `interaction_points` while keeping backward compatibility in parsing.
- **References**: `config/skill_decomposer_prompts.yaml`, `src/primitives/skill_decomposer.py`, `agents/design/primitive_task_breakdown_plan.md`, `docs/planning.md`

### 2025-11-24-1441 – Make JSON parsing fail fast

- **Owner**: AI Agent (refactor)
- **Agents affected**: SkillDecomposer interaction enrichment
- **Git commit(s)**: Based on 615f73b7d6835d214dcbe7f3d4f1a21e492354c2
- **Context**: JSON responses backed by schemas should not be softened into warnings.
- **Actions**: Removed graceful handling for interaction-point JSON parsing in `SkillDecomposer`; `json.loads` now raises on malformed responses.
- **Result**: Parsing failures propagate immediately instead of being converted into warnings.
- **References**: `src/primitives/skill_decomposer.py`

### 2025-11-24-1435 – Inline interaction point prompt flow

- **Owner**: AI Agent (refactor)
- **Agents affected**: SkillDecomposer interaction enrichment path
- **Git commit(s)**: Based on 615f73b7d6835d214dcbe7f3d4f1a21e492354c2
- **Context**: Simplify interaction-point prompting/parsing by collapsing helpers into the main synthesis path for clarity.
- **Actions**: Inlined interaction-point prompt assembly and response parsing inside `_synthesize_interaction_points`, removed the standalone helper functions, and refreshed paired docs.
- **Result**: Single flow now handles request formatting, LLM invocation, and response normalization using YAML templates/schemas.
- **References**: `src/primitives/skill_decomposer.py`, `agents/design/primitive_task_breakdown_plan.md`, `docs/planning.md`

### 2025-11-24-1430 – Skill decomposer prompt/config cleanup

- **Owner**: AI Agent (refactor + docs)
- **Agents affected**: SkillDecomposer, primitive prompt configs, planning docs
- **Git commit(s)**: Based on 615f73b7d6835d214dcbe7f3d4f1a21e492354c2
- **Context**: Align skill decomposition prompts/config with YAML sources, drop stale plan caching, and expose LLM config knobs.
- **Actions**:
  - Removed in-Python prompt strings and wired interaction point prompting/response schema to `config/skill_decomposer_prompts.yaml`.
  - Dropped plan caching and inline primitive catalog loader in favor of direct reads and class-level defaults, adding configurable `llm_config_kwargs`.
  - Updated agent-facing and product docs to reflect the new prompt sourcing and cache removal.
- **Result**: SkillDecomposer now pulls both plan and interaction prompts from YAML, surfaces adjustable LLM config defaults, and no longer caches plans or prompt/catalog contents internally.
- **References**: `src/primitives/skill_decomposer.py`, `config/skill_decomposer_prompts.yaml`, `agents/design/primitive_task_breakdown_plan.md`, `docs/planning.md`
