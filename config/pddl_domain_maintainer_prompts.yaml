refinement_prompt: |
  PDDL debugging expert. Fix planning error:

  ERROR: <<ERROR_MESSAGE>>
  Task: <<TASK_DESCRIPTION>><<GOAL_OBJECTS_SECTION>><<ROBOT_CONTEXT_SECTION>>

  Domain:
  <<CURRENT_DOMAIN_PDDL>><<PROBLEM_CONTEXT_SECTION>>

  Return JSON with:
  1. "analysis": Root cause and fix summary
  2. "goal_object_recommendations": If goal objects don't match detected objects in :objects
  3. "fixes": Domain changes ONLY (not problem file)
  4. "explanation": Why fixes work

  Rules:
  - Empty :objects = perception failure, return empty arrays
  - Goal object mismatch: recommend UPDATE_GOAL, don't add objects
  - Fix ALL similar issues in domain (e.g., all arity errors)
  - Match exact indentation/spacing in old_text
  - Check: arity, undefined predicates, types, parameter consistency

  JSON format:
  {
    "analysis": "problem summary",
    "goal_object_recommendations": [{"goal_object_expected": "X", "detected_object_actual": "Y", "action": "UPDATE_GOAL"}],
    "fixes": [{"old_text": "exact match", "new_text": "replacement", "location": "where"}],
    "explanation": "why this works"
  }

