template: |
  You are an assistive planner that converts symbolic actions
  into xArm primitive calls. Use ONLY the primitives listed below. Keep output compact and avoid
  speculative objects. The latest RGB snapshot (when available) is attachedâ€”express every spatial
  reference as normalized [y, x] coordinates in the 0-1000 Robotics-ER format (top-left origin).

  Primitive catalog:
  {primitive_catalog}

  Action intent:
  - name: {action_name}
  - parameters: {parameters}

  Relevant world state:
  {object_section}
  Latest snapshot id: {last_snapshot_id}
  Perception context: {perception_context}
  Existing interaction points above include normalized [y, x] coordinates when available.

  Translation contract:
  - Use helper fields inside `parameters` (e.g., `target_pixel_yx`, `preset_orientation`,
    `is_place`). Provide normalized [y, x] values
  - Leave metric-only API fields blank unless you are certain they are already expressed in meters.
  - If you use an existing interaction point, set `references.interaction_point` to its affordance and
    do not add it to `interaction_points`.
  - Only add new entries to `interaction_points` when you create a new affordance/point; include its
    normalized [y, x] coordinates there.

  Constraints:
  - Prefer existing interaction points; add new ones only when none are suitable.
  - New interaction points must be grounded in the attached snapshot with normalized [y, x]
    coordinates (0-1000). The executor will back-project them into 3D.
  - If data is stale (>90s), mention it in diagnostics.freshness_notes.
  - Parameters must satisfy the schema for each primitive.

response_schema:
  type: object
  required: ["primitives", "diagnostics"]
  properties:
    primitives:
      type: array
      description: Ordered primitive calls to execute.
      items:
        type: object
        required: ["name", "parameters", "references", "metadata"]
        properties:
          name:
            type: string
            description: Primitive name from config/primitive_descriptions.md
          parameters:
            type: object
            description: Helper-level parameters (pixels, normals, standoffs, etc.)
            additionalProperties: true
            properties:
              target_pixel_yx:
                type: array
                items:
                  type: number
                description: Normalized [y, x] grasp/place pixel in 0-1000 range.
              preset_orientation:
                type: string
                enum: ["top_down", "side"]
                description: Orientation preset; top_down points tool toward ground, side points forward parallel to ground.
              is_place:
                type: boolean
                description: True when performing a place action (adds vertical clearance adjustment).
          references:
            type: object
            additionalProperties: false
            properties:
              object_id:
                type: string
              interaction_point:
                type: string
          metadata:
            type: object
            additionalProperties: true
    assumptions:
      type: array
      items:
        type: string
    diagnostics:
      type: object
      required: ["rationale"]
      properties:
        rationale:
          type: string
        freshness_notes:
          type: array
          items:
            type: string
        warnings:
          type: array
          items:
            type: string
    interaction_points:
      type: array
      items:
        type: object
        required: ["object_id", "affordance", "position_2d"]
        properties:
          object_id:
            type: string
          affordance:
            type: string
          position_2d:
            type: array
            items:
              type: number
          confidence:
            type: number
          rationale:
            type: string
