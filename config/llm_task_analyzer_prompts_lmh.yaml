# Optional default robot description injected into prompts (set to null to omit)
robot_description: "The robot is a 7-DOF robot arm, with a two-finger rigid gripper as end effector. The end effector cannot grasp objects <1cm or >15cm. The robot has a Realsense RGBD camera mounted at the end effector."

# Extracted verbatim from the inline prompts in lmh/object-registry-updates
initial_analysis_prompt: |
  Analyze this robotic task and predict required PDDL components.

  TASK: <<TASK>>
  <<ROBOT_CONTEXT>>

  Return JSON with:
  {
    "action_sequence": ["action1", "action2", ...],
    "goal_predicates": ["(predicate1 obj1 obj2)", ...],
    "preconditions": ["(predicate obj)", ...],
    "initial_predicates": ["(expected_initial_states)", ...],
    "goal_objects": ["object_id1", ...],
    "global_predicates": ["global_predicate1", ...],
    "tool_objects": ["tool_id", ...],
    "obstacle_objects": ["obstacle_id", ...],
    "initial_predicates": ["(current_predicate obj)", ...],
    "relevant_predicates": ["(predicate1 ?obj)", "(predicate2 ?obj1 ?obj2)", ...],
    "required_actions": [
      {
        "name": "pick",
        "parameters": ["?obj - object"],
        "precondition": "(and (graspable ?obj) (clear ?obj))",
        "effect": "(and (holding ?obj) (not (empty-hand)))"
      }
    ],
  }

  IMPORTANT: Global Predicates
  - "global_predicates" should list predicates that represent robot/environment state, NOT object-specific predicates
  - These are predicates that should be TRUE INITIALLY before task execution
  - Examples:
    - hand_is_empty (or empty-hand): Robot gripper has no object
    - arm_at_home: Robot arm is at home position
    - gripper_open: Gripper is in open state
    - robot_ready: Robot system is initialized
  - Do NOT include object-related predicates here (those go in initial_predicates)
  - Global predicates typically have NO parameters or take robot as parameter

  IMPORTANT PDDL RULES:
  1. Parameters MUST use variables starting with ? (e.g., ?obj, ?location, ?container)
  2. Preconditions and effects use ONLY variables - NO quoted strings or constants
  3. If you need to reference a specific part (like "water_reservoir"), create a separate predicate:
     - WRONG: (is-empty ?machine "water_reservoir")
     - RIGHT: (water-reservoir-empty ?machine)
  4. All predicates should be predicates applied to variables, not string constants
  5. GLOBAL Predicates should not be returned with parenthases

  **CRITICAL ARITY RULE**: Every predicate used in preconditions and effects MUST use
  the EXACT same number of parameters as when you first define it. For example:
  - If you define `(holding ?obj)` in predicates (1 parameter)
  - Then you MUST use `(holding ?x)` in actions (1 parameter)
  - NEVER use `(holding)` (0 parameters) or `(holding ?x ?y)` (2 parameters)
  - Parameter names can differ (?obj, ?x, ?item) but the COUNT must match

  **CRITICAL SYNTAX RULE for goal_predicates**: Use proper PDDL syntax with parentheses:
  - CORRECT: `(coffee-made ?cup)` or `(inside ?obj1 ?obj2)`
  - WRONG: `coffee-made(?cup)` (no space) or `coffee-made ?cup` (missing parens)

  **VERIFICATION STEPS (complete these BEFORE returning your response):**
  Step 1: List ALL predicates you defined in `relevant_predicates`
  Step 2: For EACH action in `required_actions`:
    a) Extract all predicates from precondition
    b) Extract all predicates from effect
    c) For each predicate usage, count its parameters
    d) Find its definition in `relevant_predicates`
    e) VERIFY the parameter count EXACTLY matches
    f) If mismatch, FIX the action OR add missing predicate definition
  Step 3: Ensure every predicate used exists in `relevant_predicates`
  Step 4: Check all PDDL syntax is correct (parentheses, spaces, no commas)

  Include 8-12 relevant_predicates (clean, dirty, on, holding, empty-hand, graspable, reachable, etc.) and 3-5 required_actions.

analysis_prompt: |
  You are a robotic task planner. Analyze this task given the observed scene.

  TASK: <<TASK>>
  <<ROBOT_CONTEXT>>
  OBSERVED OBJECTS:
  <<OBJECT_LIST>>

  OBSERVED RELATIONSHIPS:
  <<RELATIONSHIP_LIST>>

  Provide a JSON response with:
  {
    "action_sequence": ["action1", "action2", ...],
    "goal_predicates": ["(predicate1 obj1 obj2)", ...],
    "preconditions": ["(predicate obj)", ...],
    "initial_predicates": ["(expected_initial_states)", ...],
    "goal_objects": ["object_id1", ...],
    "global_predicates": ["global_predicate1", ...],
    "tool_objects": ["tool_id", ...],
    "obstacle_objects": ["obstacle_id", ...],
    "initial_predicates": ["(current_predicate obj)", ...],
    "relevant_predicates": ["(predicate1 ?obj)", "(predicate2 ?obj1 ?obj2)", ...],
    "required_actions": [
      {
        "name": "pick",
        "parameters": ["?obj - object"],
        "precondition": "(and (graspable ?obj) (clear ?obj))",
        "effect": "(and (holding ?obj) (not (empty-hand)))"
      }
    ],
    "complexity": "simple|medium|complex",
    "estimated_steps": 3
  }

  CRITICAL PDDL FORMATTING RULES:
  1. Parameters MUST use variables with ? prefix (e.g., ?obj, ?location, ?machine)
  2. Preconditions and effects can ONLY use:
     - Variables (e.g., ?obj, ?container)
     - Predicate names (e.g., graspable, empty-hand, has-water)
  3. NEVER use quoted strings or constants in preconditions/effects
  4. If referencing a component, make it a predicate:
     - WRONG: (is-empty ?machine "water_reservoir")
     - RIGHT: (water-reservoir-empty ?machine) or (reservoir-has-water ?machine)
  5. Multi-word predicates use hyphens: has-water, is-empty, water-reservoir-empty
  6. GLOBAL Predicates should not be returned with parenthases

  **CRITICAL ARITY RULE**: Every predicate used in preconditions and effects MUST use
  the EXACT same number of parameters as when you first define it. For example:
  - If you define `(holding ?obj)` in predicates (1 parameter)
  - Then you MUST use `(holding ?x)` in actions (1 parameter)
  - NEVER use `(holding)` (0 parameters) or `(holding ?x ?y)` (2 parameters)
  - Parameter names can differ (?obj, ?x, ?item) but the COUNT must match

  **CRITICAL SYNTAX RULE for goal_predicates**: Use proper PDDL syntax with parentheses:
  - CORRECT: `(coffee-made ?cup)` or `(inside ?obj1 ?obj2)`
  - WRONG: `coffee-made(?cup)` (no space) or `coffee-made ?cup` (missing parens)


  IMPORTANT: Global Predicates
      - "global_predicates" should list predicates that represent robot/environment state, NOT object-specific predicates
      - These are predicates that should be TRUE INITIALLY before task execution
      - Examples:
      - hand_is_empty (or empty-hand): Robot gripper has no object
      - arm_at_home: Robot arm is at home position
      - gripper_open: Gripper is in open state
      - robot_ready: Robot system is initialized
      - Do NOT include object-related predicates here (those go in initial_predicates)
      - Global predicates typically have NO parameters or take robot as parameter

  **VERIFICATION STEPS (complete these BEFORE returning your response):**
  Step 1: List ALL predicates you defined in `relevant_predicates`
  Step 2: For EACH action in `required_actions`:
    a) Extract all predicates from precondition
    b) Extract all predicates from effect
    c) For each predicate usage, count its parameters
    d) Find its definition in `relevant_predicates`
    e) VERIFY the parameter count EXACTLY matches
    f) If mismatch, FIX the action OR add missing predicate definition
  Step 3: Ensure every predicate used exists in `relevant_predicates`
  Step 4: Check all PDDL syntax is correct (parentheses, spaces, no commas)

  Example verification for action "pick":
  - Precondition uses: `(empty-hand)` → 0 params
  - Check definition: `(empty-hand)` → 0 params ✓ MATCH
  - Precondition uses: `(graspable ?obj)` → 1 param
  - Check definition: `(graspable ?obj)` → 1 param ✓ MATCH
  - Effect uses: `(holding ?obj)` → 1 param
  - Check definition: `(holding ?obj)` → 1 param ✓ MATCH

  Focus on:
  1. Use observed objects and their actual IDs
  2. Generate predicates matching observed affordances
  3. Create action sequence using observed objects
  4. Include all task-relevant predicates
  5. Ensure all PDDL actions follow proper syntax (no quoted strings!)
